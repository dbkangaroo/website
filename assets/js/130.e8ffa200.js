(window.webpackJsonp=window.webpackJsonp||[]).push([[130],{714:function(t,a,n){"use strict";n.r(a);var s=n(13),e=Object(s.a)({},(function(){var t=this,a=t.$createElement,n=t._self._c||a;return n("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[n("h1",{attrs:{id:"袋鼠-gtk4-版升级报告-第一阶段"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#袋鼠-gtk4-版升级报告-第一阶段"}},[t._v("#")]),t._v(" 袋鼠 GTK4 版升级报告（第一阶段）")]),t._v(" "),n("p",[t._v("袋鼠数据库工具(基于 GTK3 开发) 已于 2021-10-29 日通过了基于 GTK4 框架及其依赖库的编译，整个升级过程耗时约6个星期，遇到了许多典型性的问题，觉得有分享价值，就总结提炼出来形成这个报告。")]),t._v(" "),n("h2",{attrs:{id:"项目信息"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#项目信息"}},[t._v("#")]),t._v(" 项目信息")]),t._v(" "),n("p",[t._v("我们先对项目做一个大概的预览，了解一下项目的基本情况，有助于加深对后面的内容的理解：")]),t._v(" "),n("ul",[n("li",[t._v("开发者: 1 人")]),t._v(" "),n("li",[t._v("开发机器: ThinkPad T450 + Windows 10")]),t._v(" "),n("li",[t._v("源码文件: 364（个）")]),t._v(" "),n("li",[t._v("界面定义文件: 23（个）")]),t._v(" "),n("li",[t._v("图标文件(SVG): 58（个）")]),t._v(" "),n("li",[t._v("操作熟练: 280（个）")]),t._v(" "),n("li",[t._v("支持平台: Windows, macOS, Linux")])]),t._v(" "),n("h2",{attrs:{id:"开发环境"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#开发环境"}},[t._v("#")]),t._v(" 开发环境")]),t._v(" "),n("p",[t._v("袋鼠数据库工具的开发环境是基于 MSYS2 工具套件搭建的，IDE使用 VSCode，详细情况如下:"),n("br")]),t._v(" "),n("table",[n("thead",[n("tr",[n("th",[t._v("功能特性")]),t._v(" "),n("th",[t._v("工具名称")]),t._v(" "),n("th",[t._v("采用版本")])])]),t._v(" "),n("tbody",[n("tr",[n("td",[t._v("包管理器")]),t._v(" "),n("td",[t._v("pacman")]),t._v(" "),n("td",[t._v("6.0.1")])]),t._v(" "),n("tr",[n("td",[t._v("编译器")]),t._v(" "),n("td",[t._v("GCC + Vala")]),t._v(" "),n("td",[t._v("10.3 / 0.54.2")])]),t._v(" "),n("tr",[n("td",[t._v("终端")]),t._v(" "),n("td",[t._v("mintty")]),t._v(" "),n("td",[t._v("3.5.1")])]),t._v(" "),n("tr",[n("td",[t._v("集成开发环境")]),t._v(" "),n("td",[t._v("Visual Studio Code + Vala")]),t._v(" "),n("td",[t._v("1.60")])]),t._v(" "),n("tr",[n("td",[t._v("构建器")]),t._v(" "),n("td",[t._v("meson + ninja")]),t._v(" "),n("td",[t._v("0.58")])]),t._v(" "),n("tr",[n("td",[t._v("安装包工具")]),t._v(" "),n("td",[t._v("NSIS")]),t._v(" "),n("td",[t._v("3.0.6")])]),t._v(" "),n("tr",[n("td",[t._v("虚拟机")]),t._v(" "),n("td",[t._v("VirtualBox")]),t._v(" "),n("td",[t._v("6.1")])])])]),t._v(" "),n("div",[n("script2",{attrs:{type:"text/javascript",async:"true",src:"https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"}}),t._v(" "),n("ins",{staticClass:"adsbygoogle",staticStyle:{display:"block","text-align":"center"},attrs:{"data-ad-layout":"in-article","data-ad-format":"fluid","data-ad-client":"ca-pub-3975819313740938","data-ad-slot":"6760827895"}}),t._v(" "),n("script2",{attrs:{type:"text/javascript"}},[t._v("\n        (adsbygoogle = window.adsbygoogle || []).push({});\n    ")])],1),t._v(" "),n("p",[t._v("袋鼠数据库工具 集成了很多第三方库，第三方库及其官网、版本明细如下：")]),t._v(" "),n("table",[n("thead",[n("tr",[n("th",[t._v("功能特性")]),t._v(" "),n("th",[t._v("第三方库")]),t._v(" "),n("th",[t._v("采用版本")])])]),t._v(" "),n("tbody",[n("tr",[n("td",[t._v("编译器")]),t._v(" "),n("td",[n("a",{attrs:{href:"https://gitlab.gnome.org/GNOME/vala",target:"_blank",rel:"noopener noreferrer"}},[t._v("Vala"),n("OutboundLink")],1)]),t._v(" "),n("td",[t._v("0.54.2")])]),t._v(" "),n("tr",[n("td",[t._v("基础库")]),t._v(" "),n("td",[n("a",{attrs:{href:"https://gitlab.gnome.org/GNOME/glib",target:"_blank",rel:"noopener noreferrer"}},[t._v("GLib2"),n("OutboundLink")],1)]),t._v(" "),n("td",[t._v("2.68.1")])]),t._v(" "),n("tr",[n("td",[t._v("界面框架")]),t._v(" "),n("td",[n("a",{attrs:{href:"https://gitlab.gnome.org/GNOME/gtk",target:"_blank",rel:"noopener noreferrer"}},[t._v("GTK3 --\x3e GTK4"),n("OutboundLink")],1)]),t._v(" "),n("td",[t._v("3.24.30 --\x3e 4.4.0")])]),t._v(" "),n("tr",[n("td",[t._v("界面适配库")]),t._v(" "),n("td",[n("a",{attrs:{href:"https://gitlab.gnome.org/GNOME/libhandy",target:"_blank",rel:"noopener noreferrer"}},[t._v("libhandy"),n("OutboundLink")],1),t._v(" --\x3e "),n("a",{attrs:{href:"https://gitlab.gnome.org/GNOME/libhandy",target:"_blank",rel:"noopener noreferrer"}},[t._v("libadwaita"),n("OutboundLink")],1)]),t._v(" "),n("td",[t._v("1.4.0  --\x3e 1.0.0 alpha2")])]),t._v(" "),n("tr",[n("td",[t._v("编辑器")]),t._v(" "),n("td",[n("a",{attrs:{href:"https://gitlab.gnome.org/GNOME/gtksourceview",target:"_blank",rel:"noopener noreferrer"}},[t._v("GtkSourceView4 --\x3e GtkSourceView5"),n("OutboundLink")],1)]),t._v(" "),n("td",[t._v("4.8.2 --\x3e 5.2.0")])]),t._v(" "),n("tr",[n("td",[t._v("地图")]),t._v(" "),n("td",[n("a",{attrs:{href:"https://gitlab.gnome.org/GNOME/libshumate",target:"_blank",rel:"noopener noreferrer"}},[t._v("libshumate"),n("OutboundLink")],1)]),t._v(" "),n("td",[t._v("unknown")])]),t._v(" "),n("tr",[n("td",[t._v("JSON")]),t._v(" "),n("td",[n("a",{attrs:{href:"https://gitlab.gnome.org/GNOME/json-glib",target:"_blank",rel:"noopener noreferrer"}},[t._v("json-glib"),n("OutboundLink")],1)]),t._v(" "),n("td",[t._v("1.6.6")])]),t._v(" "),n("tr",[n("td",[t._v("数据库访问")]),t._v(" "),n("td",[n("a",{attrs:{href:"https://gitlab.gnome.org/GNOME/libgda",target:"_blank",rel:"noopener noreferrer"}},[t._v("libgda"),n("OutboundLink")],1)]),t._v(" "),n("td",[t._v("6.0.0")])]),t._v(" "),n("tr",[n("td",[t._v("容器")]),t._v(" "),n("td",[n("a",{attrs:{href:"https://gitlab.gnome.org/GNOME/libgee",target:"_blank",rel:"noopener noreferrer"}},[t._v("libgee"),n("OutboundLink")],1)]),t._v(" "),n("td",[t._v("0.20.3")])]),t._v(" "),n("tr",[n("td",[t._v("SSH")]),t._v(" "),n("td",[n("a",{attrs:{href:"https://github.com/libssh2/libssh2",target:"_blank",rel:"noopener noreferrer"}},[t._v("libssh2"),n("OutboundLink")],1)]),t._v(" "),n("td",[t._v("1.9.0")])]),t._v(" "),n("tr",[n("td",[t._v("XML")]),t._v(" "),n("td",[n("a",{attrs:{href:"https://gitlab.gnome.org/GNOME/libxml2",target:"_blank",rel:"noopener noreferrer"}},[t._v("libxml2"),n("OutboundLink")],1)]),t._v(" "),n("td",[t._v("2.9.12")])]),t._v(" "),n("tr",[n("td",[t._v("加解密")]),t._v(" "),n("td",[n("a",{attrs:{href:"https://www.openssl.org/",target:"_blank",rel:"noopener noreferrer"}},[t._v("OpenSSL"),n("OutboundLink")],1)]),t._v(" "),n("td",[t._v("1.1.1.k")])]),t._v(" "),n("tr",[n("td",[t._v("编码")]),t._v(" "),n("td",[n("a",{attrs:{href:"https://gitlab.freedesktop.org/uchardet/uchardet",target:"_blank",rel:"noopener noreferrer"}},[t._v("uchardet"),n("OutboundLink")],1)]),t._v(" "),n("td",[t._v("0.0.7")])]),t._v(" "),n("tr",[n("td",[t._v("插件支持")]),t._v(" "),n("td",[n("a",{attrs:{href:"https://gitlab.gnome.org/GNOME/libpeas",target:"_blank",rel:"noopener noreferrer"}},[t._v("libpeas"),n("OutboundLink")],1)]),t._v(" "),n("td",[t._v("1.30.0")])]),t._v(" "),n("tr",[n("td",[t._v("文件格式")]),t._v(" "),n("td",[n("a",{attrs:{href:"https://github.com/libarchive/libarchive",target:"_blank",rel:"noopener noreferrer"}},[t._v("libarchive"),n("OutboundLink")],1)]),t._v(" "),n("td",[t._v("3.5.1")])]),t._v(" "),n("tr",[n("td",[t._v("HTTP")]),t._v(" "),n("td",[n("a",{attrs:{href:"https://gitlab.gnome.org/GNOME/libsoup",target:"_blank",rel:"noopener noreferrer"}},[t._v("libsoup"),n("OutboundLink")],1)]),t._v(" "),n("td",[t._v("2.72.0")])]),t._v(" "),n("tr",[n("td",[t._v("模板")]),t._v(" "),n("td",[n("a",{attrs:{href:"https://gitlab.gnome.org/GNOME/template-glib",target:"_blank",rel:"noopener noreferrer"}},[t._v("template-glib"),n("OutboundLink")],1)]),t._v(" "),n("td",[t._v("3.34.0")])])])]),t._v(" "),n("h2",{attrs:{id:"gtk4-升级过程摘要"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#gtk4-升级过程摘要"}},[t._v("#")]),t._v(" GTK4 升级过程摘要")]),t._v(" "),n("p",[t._v("为实现GTK4版编译通过，先后对代码进行了5轮重构和问题修复，每一轮都产生并修复了大量问题，面对兼容性产生的巨大的工作量，一度想放弃升级到GTK4版，短暂停留后继续攻坚，终于通过了编译：")]),t._v(" "),n("table",[n("thead",[n("tr",[n("th",[t._v("轮次")]),t._v(" "),n("th",[t._v("重构与修复重点")]),t._v(" "),n("th",[t._v("问题数")])])]),t._v(" "),n("tbody",[n("tr",[n("td",[t._v("第一轮")]),t._v(" "),n("td",[t._v("1. 修复名字空间方面的问题"),n("br"),t._v("2. 修复移除的API问题")]),t._v(" "),n("td",[t._v("400+")])]),t._v(" "),n("tr",[n("td",[t._v("第二轮")]),t._v(" "),n("td",[t._v("1. 修复容器控件GtkContainer相关问题"),n("br"),t._v("2. 修复唯一控件GtkBin相关问题")]),t._v(" "),n("td",[t._v("1720+")])]),t._v(" "),n("tr",[n("td",[t._v("第三轮")]),t._v(" "),n("td",[t._v("1. 修复剪贴板相关问题"),n("br"),t._v("2. 修复鼠标、键盘等输入事件问题")]),t._v(" "),n("td",[t._v("1454")])]),t._v(" "),n("tr",[n("td",[t._v("第四轮")]),t._v(" "),n("td",[t._v("1. 修复GtkBuilder相关问题"),n("br"),t._v("2. 修复界面定义相关问题")]),t._v(" "),n("td",[t._v("800+")])]),t._v(" "),n("tr",[n("td",[t._v("第五轮")]),t._v(" "),n("td",[t._v("修复新增的 final 标记相关问题:"),n("br"),t._v("GtkPaned"),n("br"),t._v("GtkScrolledWindow"),n("br"),t._v("GtkStack"),n("br"),t._v("GtkOverlay"),n("br"),t._v("GtkNotebook"),n("br"),t._v("GtkTreeViewColumn"),n("br"),t._v("Gtk.ComboBoxText"),n("br"),t._v("Gtk.Assistant")]),t._v(" "),n("td",[t._v("8 个控件类问题"),n("br"),t._v("共 1430+ 个")])])])]),t._v(" "),n("p",[t._v("通过持续6周的努力，最终迎来了袋鼠GTK4版编译通过（10/29/2021）, 欣喜若狂，立即执行编译通过的程序，有点丑有点不正常，很多功能无法正常使用，它宣示GTK4编译通过只是整个升级工作的万里长征第一步，还需许多的工作需要做。")]),t._v(" "),n("div",[n("script2",{attrs:{type:"text/javascript",async:"true",src:"https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"}}),t._v(" "),n("ins",{staticClass:"adsbygoogle",staticStyle:{display:"block","text-align":"center"},attrs:{"data-ad-layout":"in-article","data-ad-format":"fluid","data-ad-client":"ca-pub-3975819313740938","data-ad-slot":"6760827895"}}),t._v(" "),n("script2",{attrs:{type:"text/javascript"}},[t._v("\n        (adsbygoogle = window.adsbygoogle || []).push({});\n    ")])],1),t._v(" "),n("h2",{attrs:{id:"关键问题分析和解决方案"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#关键问题分析和解决方案"}},[t._v("#")]),t._v(" 关键问题分析和解决方案")]),t._v(" "),n("p",[t._v("现在我将把升级过程中的一些关键的、典型问题做一些列举分析并提供解决方案，或许对读者有一些帮助。")]),t._v(" "),n("h3",{attrs:{id:"_1-容器控件-api"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-容器控件-api"}},[t._v("#")]),t._v(" 1. 容器控件 API")]),t._v(" "),n("p",[t._v("在 GTK4 中, 容器类 GtkContainer 已经被移除，新的控件体系允许每一个控件都能添加子控件，相应的API也有变化，一致性在减弱，未来也许会重新规范为一个接口类并集成到每一个控件中；GTK4版提供的容器 API 主要有: prepend/append/insert/remove:")]),t._v(" "),n("table",[n("thead",[n("tr",[n("th",[t._v("GTK3 API")]),t._v(" "),n("th",[t._v("GTK4 API")]),t._v(" "),n("th",[t._v("升级推荐")])])]),t._v(" "),n("tbody",[n("tr",[n("td",[t._v("add"),n("br"),t._v("pack_start")]),t._v(" "),n("td",[t._v("prepend"),n("br"),t._v(" append")]),t._v(" "),n("td",[t._v("append")])]),t._v(" "),n("tr",[n("td",[t._v("pack_end")]),t._v(" "),n("td",[t._v("insert_child_after")]),t._v(" "),n("td",[t._v("append")])]),t._v(" "),n("tr",[n("td",[t._v("reorder_child")]),t._v(" "),n("td",[t._v("reorder_child_after")]),t._v(" "),n("td",[t._v("reorder_child_after")])]),t._v(" "),n("tr",[n("td",[t._v("foreach/get_children")]),t._v(" "),n("td",[t._v("get_first_child"),n("br"),t._v("get_next_sibling"),n("br"),t._v("get_prev_sibling"),n("br"),t._v("get_last_child")]),t._v(" "),n("td")])])]),t._v(" "),n("h3",{attrs:{id:"_2-唯一子控件-api"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-唯一子控件-api"}},[t._v("#")]),t._v(" 2. 唯一子控件 API")]),t._v(" "),n("p",[t._v("在 GTK4 中, , 唯一子控件类GtkBin 已经被移除, 新的控件体系允许每一个控件都能添加子控件, 部分控件类提供了 child 属性来直接引用或设置它的唯一子控件，或者是第一个子控件；")]),t._v(" "),n("h3",{attrs:{id:"_3-剪贴板-api"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-剪贴板-api"}},[t._v("#")]),t._v(" 3. 剪贴板 API")]),t._v(" "),n("p",[t._v("在 GTK3 中, 我们可以使用下面的代码获取或者检测剪贴板中的图片:")]),t._v(" "),n("div",{staticClass:"language-vala extra-class"},[n("pre",{pre:!0,attrs:{class:"language-vala"}},[n("code",[n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Gtk"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Clipboard")]),t._v(" clipboard "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" Gtk"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Clipboard"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("get")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Gdk"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token constant"}},[t._v("SELECTION_CLIPBOARD")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Pixbuf")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),t._v(" pixbuf "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" clipboard"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("wait_for_image")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),n("p",[t._v("GTK4 中的完成同样功能的代码是这样子的:")]),t._v(" "),n("div",{staticClass:"language-vala extra-class"},[n("pre",{pre:!0,attrs:{class:"language-vala"}},[n("code",[n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Pixbuf")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),t._v(" pixbuf "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Value")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("value")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" GLib"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("Value")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("typeof")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Pixbuf"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Gdk"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Clipboard")]),t._v(" clipboard "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("get_clipboard")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("clipboard"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("content"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("get_value")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ref")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("value")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    pixbuf "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Pixbuf"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("value")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("get_boxed")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("div",[n("script2",{attrs:{type:"text/javascript",async:"true",src:"https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"}}),t._v(" "),n("ins",{staticClass:"adsbygoogle",staticStyle:{display:"block","text-align":"center"},attrs:{"data-ad-layout":"in-article","data-ad-format":"fluid","data-ad-client":"ca-pub-3975819313740938","data-ad-slot":"6760827895"}}),t._v(" "),n("script2",{attrs:{type:"text/javascript"}},[t._v("\n        (adsbygoogle = window.adsbygoogle || []).push({});\n    ")])],1),t._v(" "),n("h3",{attrs:{id:"_4-用户输入-鼠标点击和键盘输入"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_4-用户输入-鼠标点击和键盘输入"}},[t._v("#")]),t._v(" 4. 用户输入（鼠标点击和键盘输入)")]),t._v(" "),n("p",[t._v("简单粗暴的直接分享一些关于用户输入的参考代码，用于快速更新 GTK3 中的用户输入事件代码：")]),t._v(" "),n("div",{staticClass:"language-vala extra-class"},[n("pre",{pre:!0,attrs:{class:"language-vala"}},[n("code",[t._v("treeview"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("key_press_event"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("connect")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("key_press_handler"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\ntreeview"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("key_release_event"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("connect")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("key_release_handler"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\ntreeview"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("button_press_event"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("connect")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("button_press_handler"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\ntreeview"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("button_release_event"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("connect")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("button_release_handler"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\ntreeview"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("motion_notify_event"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("connect")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("mouse_move_handler"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\ntreeview"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("enter_notify_event"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("connect")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("mouse_enter_handler"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\ntreeview"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("leave_notify_event"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("connect")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("mouse_leave_handler"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\ntreeview"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("scroll_event"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("connect")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("scroll_event_handler"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\ntreeview"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("focus_in_event"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("connect")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("focus_enter_event_handler"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\ntreeview"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("focus_out_event"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("connect")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("focus_leave_event_handler"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),n("div",{staticClass:"language-vala extra-class"},[n("pre",{pre:!0,attrs:{class:"language-vala"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" key_input_event "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Gtk"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("EventControllerKey")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nkey_input_event"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("key_pressed"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("connect")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("key_press_handler"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nkey_input_event"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("key_released"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("connect")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("key_release_handler"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\ntreeview"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("add_controller")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("key_input_event"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" mouse_button_event "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Gtk"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("GestureClick")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nmouse_button_event"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("pressed"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("connect")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("button_press_handler"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nmouse_button_event"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("released"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("connect")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("button_release_handler"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\ntreeview"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("add_controller")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("mouse_button_event"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" mouse_motion_event "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Gtk"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("EventControllerMotion")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nmouse_motion_event"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("motion"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("connect")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("mouse_move_handler"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nmouse_motion_event"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("enter"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("connect")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("mouse_enter_handler"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nmouse_motion_event"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("leave"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("connect")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("mouse_leave_handler"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\ntreeview"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("add_controller")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("mouse_motion_event"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" view_scroll_event "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Gtk"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("EventControllerScroll")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nview_scroll_event"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("scroll"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("connect")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("scroll_event_handler"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\ntreeview"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("add_controller")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("view_scroll_event"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" view_focus_event "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Gtk"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("EventControllerFocus")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nview_focus_event"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("enter"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("connect")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("focus_enter_event_handler"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nview_focus_event"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("leave"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("connect")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("focus_leave_event_handler"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\ntreeview"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("add_controller")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("view_focus_event"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),n("h3",{attrs:{id:"_5-gtkbuilder-和-界面定义文件"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_5-gtkbuilder-和-界面定义文件"}},[t._v("#")]),t._v(" 5. GtkBuilder 和 界面定义文件")]),t._v(" "),n("p",[t._v("下面的命令行可以直接升级更新GTK3定义的界面定义文件（*.ui):")]),t._v(" "),n("div",{staticClass:"language-bash extra-class"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[t._v("gtk-builder-tool simplify --3to4 --replace "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("filename.ui"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n")])])]),n("p",[t._v("如果只想查看升级更新后的界面定义文件内容而不更新文件，可以去掉参数 "),n("code",[t._v("--replace")]),t._v("，如下所示：")]),t._v(" "),n("div",{staticClass:"language-bash extra-class"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[t._v("gtk-builder-tool simplify --3to4 "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("filename.ui"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n")])])])])}),[],!1,null,null,null);a.default=e.exports}}]);